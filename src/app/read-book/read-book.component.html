<h2>Book Details</h2>
<hr/>

<div *ngIf="book">
  <div><label><b>Title:</b></label> {{ book.title }}</div>
  <div><label><b>Author:</b></label> {{ book.author }}</div>
  <div><label><b>ISBN:</b></label> {{ book.isbn }}</div>
  <div><label><b>Genre:</b></label> {{ book.genre }}</div>
</div>

<h4 class="mt-5">Search Users to Loan This Book</h4>

<div class="input-group my-3">
  <input type="text" class="form-control" [(ngModel)]="searchLastName" placeholder="Search by last name"/>
  <button class="btn btn-outline-primary" (click)="searchUsers()">Search</button>
</div>

<div *ngIf="foundUsers.length > 0" class="table-responsive">
  <table class="table table-bordered table-hover text-center">
    <thead class="table-light">
    <tr>
      <th>User No.</th>
      <th>First Name</th>
      <th>Last Name</th>
      <th>PESEL</th>
      <th>Action</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let user of foundUsers">
      <td>{{ user.id }}</td>
      <td>{{ user.firstName }}</td>
      <td>{{ user.lastName }}</td>
      <td>{{ user.pesel }}</td>
      <td>
        <button class="btn btn-success btn-sm"
                [disabled]="!isBookAvailable()"
                (click)="borrowBook(user.id)">
          Borrow
        </button>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<h4 class="mt-5">Loans</h4>
<div *ngIf="bookLoans?.length; else noBookLoans" class="table-responsive mt-3">
  <table class="table table-bordered table-striped mt-2">
    <thead class="thead-dark">
    <tr>
      <th>Full Name</th>
      <th>PESEL</th>
      <th>Loaned</th>
      <th>Returned</th>
      <th>Action</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor="let loan of bookLoans">
      <td>{{ loan.firstName }} {{ loan.lastName }}</td>
      <td>{{ loan.pesel }}</td>
      <td>{{ loan.start }}</td>
      <td>{{ loan.finish ? loan.finish : '-' }}</td>
      <td>
        <button
          *ngIf="!loan.finish"
          class="btn btn-warning btn-sm"
          (click)="returnBook(loan.id)">
          Return
        </button>
      </td>
    </tr>
    </tbody>
  </table>
</div>

<ng-template #noBookLoans>
  <p>This book has not been borrowed yet.</p>
</ng-template>

<div class="text-center mt-4">
  <button (click)="list()" class="btn btn-primary">Back to Book List</button>
</div>
